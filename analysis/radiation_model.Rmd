---
title: "Radiation Model"
output: html_document
---
```{r setup, message = FALSE, warning = FALSE, include = TRUE}
library(tidyverse)
library(here)
devtools::load_all()
```

## Background research
As seen in the image below and as explained in Caleb Robinson and Bistra Dilkina's paper, ["A Machine Learning Approach to Modeling Human Migration"](https://doi.org/10.1145/3209811.3209868), the traditional migration models can be written as the product of two parts: $T_{ij} = G_i * P_{ij}$. 

  * $T_{ij}$ is the number of people moving from every zone i to every other zone j
  * $G_i = \alpha * m_i$ is the production function that estimates number of people leaving zone i
    * $m_i$ is the population of zone i and $\alpha$ is a parameter tuned using historical data
  * $P_{ij}$ is the probability of a move occurring from i to j
    * Robinson and Dilkina note that the probability of moving from i to all other destinations j should sum to 1

```{r pressure, echo=FALSE, out.width = '75%'}
knitr::include_graphics(here("documentation", "project_notes", "Robinson_and_Dilkina_Table_1.PNG"))
```

To implement the radiation model, we'll need to create a matrix, $S_{ij}$ that will provide us with intervening opportunities between zones i and j that migrants would likely consider while moving to zone j.

## Create S_ij

$s_{ij}$ is defined as the population of all zones between i and j (excluding zones i and j) within a circle centered at i with radius d_ij. This means we'll need to use our matrices for distances between zones and population estimates for every zone.

Let's generate intervening opportunities for all the datasets we have.
```{r}
pop_estimates <- read.csv(here("results", "data_cleaning_results", "population_estimates.csv"))
locations <- read.csv(here("results", "distances_between_states.csv"))
columns <- colnames(pop_estimates)

result <- map(columns, ~ generate_int_opp_files(., pop_estimates, locations))
```


## Create T_ij

Now let's get radiation model estimates for every year of data we have on hand.
```{r}
pop_estimates <- read.csv(here("results", "data_cleaning_results", "population_estimates.csv"))
columns <- colnames(pop_estimates)
alpha <- 0.3

result <- map(columns, ~ generate_radiation_matrices(., pop_estimates, alpha))
```

